# hash:sha256:8bc6b9b5d6afca93b320deb38644b67fd03a0e4c91d1bea786fe75730e5e043e
FROM registry.codeocean.com/codeocean/pytorch:2.1.0-cuda11.8.0-mambaforge23.1.0-4-python3.10.12-ubuntu22.04

ARG DEBIAN_FRONTEND=noninteractive

RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        build-essential=12.9ubuntu3 \
    && rm -rf /var/lib/apt/lists/*

RUN conda install -y --channel=pytorch --channel=huggingface --channel=nvidia --channel=anaconda --channel=conda-forge --channel=defaults \
        _libgcc_mutex==0.1 \
        _openmp_mutex==4.5 \
        alabaster==0.7.16 \
        alsa-lib==1.2.10 \
        appdirs==1.4.4 \
        arrow==1.3.0 \
        astroid==2.15.8 \
        asttokens==2.4.1 \
        atk-1.0==2.38.0 \
        atomicwrites==1.4.1 \
        attr==2.5.1 \
        attrs==23.2.0 \
        autopep8==2.0.4 \
        aws-c-auth==0.7.11 \
        aws-c-cal==0.6.9 \
        aws-c-common==0.9.12 \
        aws-c-compression==0.2.17 \
        aws-c-event-stream==0.4.1 \
        aws-c-http==0.8.0 \
        aws-c-io==0.14.0 \
        aws-c-mqtt==0.10.1 \
        aws-c-s3==0.4.9 \
        aws-c-sdkutils==0.1.13 \
        aws-checksums==0.1.17 \
        aws-crt-cpp==0.26.0 \
        aws-sdk-cpp==1.11.210 \
        babel==2.14.0 \
        beautifulsoup4==4.12.3 \
        binaryornot==0.4.4 \
        black==24.1.1 \
        bleach==6.1.0 \
        boost-cpp==1.78.0 \
        brotli-python==1.1.0 \
        bzip2==1.0.8 \
        c-ares==1.26.0 \
        ca-certificates==2024.2.2 \
        cairo==1.18.0 \
        certifi==2023.11.17 \
        cffi==1.16.0 \
        chardet==5.2.0 \
        charset-normalizer==3.3.2 \
        click==8.1.7 \
        cloudpickle==3.0.0 \
        colorama==0.4.6 \
        comm==0.2.1 \
        cookiecutter==2.5.0 \
        cryptography==42.0.2 \
        cuda-cudart==11.8.89 \
        cuda-cupti==11.8.87 \
        cuda-libraries==11.8.0 \
        cuda-nvrtc==11.8.89 \
        cuda-nvtx==11.8.86 \
        cuda-runtime==11.8.0 \
        dataclasses==0.8 \
        dbus==1.13.6 \
        debugpy==1.8.0 \
        decorator==5.1.1 \
        defusedxml==0.7.1 \
        diff-match-patch==20230430 \
        docker-pycreds==0.4.0 \
        docstring-to-markdown==0.13 \
        docutils==0.20.1 \
        entrypoints==0.4 \
        exceptiongroup==1.2.0 \
        executing==2.0.1 \
        expat==2.5.0 \
        ffmpeg==4.3 \
        filelock==3.13.1 \
        flake8==6.0.0 \
        font-ttf-dejavu-sans-mono==2.37 \
        font-ttf-inconsolata==3.000 \
        font-ttf-source-code-pro==2.038 \
        font-ttf-ubuntu==0.83 \
        fontconfig==2.14.2 \
        fonts-conda-ecosystem==1 \
        fonts-conda-forge==1 \
        freetype==2.12.1 \
        fribidi==1.0.10 \
        gdk-pixbuf==2.42.10 \
        gettext==0.21.1 \
        gflags==2.2.2 \
        giflib==5.2.1 \
        gitdb==4.0.11 \
        gitpython==3.1.41 \
        glib==2.78.3 \
        glib-tools==2.78.3 \
        glog==0.6.0 \
        gmp==6.3.0 \
        gmpy2==2.1.2 \
        gnutls==3.6.13 \
        graphite2==1.3.13 \
        graphviz==2.50.0 \
        gst-plugins-base==1.22.9 \
        gstreamer==1.22.9 \
        gtk2==2.24.33 \
        gts==0.7.6 \
        harfbuzz==8.3.0 \
        huggingface_hub==0.17.3 \
        icu==73.2 \
        idna==3.6 \
        imagesize==1.4.1 \
        importlib-metadata==7.0.1 \
        importlib_metadata==7.0.1 \
        importlib_resources==6.1.1 \
        inflection==0.5.1 \
        intervaltree==3.1.0 \
        ipykernel==6.29.0 \
        ipython==8.18.1 \
        ipython_genutils==0.2.0 \
        isort==5.13.2 \
        jaraco.classes==3.3.0 \
        jedi==0.18.2 \
        jeepney==0.8.0 \
        jellyfish==1.0.3 \
        jinja2==3.1.3 \
        jsonschema==4.21.1 \
        jsonschema-specifications==2023.12.1 \
        jupyter_client==8.6.0 \
        jupyter_core==5.7.1 \
        jupyterlab_pygments==0.3.0 \
        keyring==24.3.0 \
        keyutils==1.6.1 \
        krb5==1.21.2 \
        lame==3.100 \
        lazy-object-proxy==1.10.0 \
        lcms2==2.15 \
        ld_impl_linux-64==2.40 \
        lerc==4.0.0 \
        libabseil==20230802.1 \
        libarrow==11.0.0 \
        libblas==3.9.0 \
        libbrotlicommon==1.1.0 \
        libbrotlidec==1.1.0 \
        libbrotlienc==1.1.0 \
        libcap==2.69 \
        libcblas==3.9.0 \
        libclang13==15.0.7 \
        libcrc32c==1.1.2 \
        libcublas==11.11.3.6 \
        libcufft==10.9.0.58 \
        libcufile==1.8.1.2 \
        libcups==2.3.3 \
        libcurand==10.3.4.107 \
        libcurl==8.5.0 \
        libcusolver==11.4.1.48 \
        libcusparse==11.7.5.86 \
        libdeflate==1.18 \
        libedit==3.1.20191231 \
        libev==4.33 \
        libevent==2.1.12 \
        libexpat==2.5.0 \
        libffi==3.4.2 \
        libflac==1.4.3 \
        libgcc-ng==13.2.0 \
        libgcrypt==1.10.3 \
        libgd==2.3.3 \
        libgfortran-ng==13.2.0 \
        libgfortran5==13.2.0 \
        libglib==2.78.3 \
        libgomp==13.2.0 \
        libgoogle-cloud==2.12.0 \
        libgpg-error==1.47 \
        libgrpc==1.59.3 \
        libiconv==1.17 \
        libjpeg-turbo==2.1.5.1 \
        liblapack==3.9.0 \
        libllvm15==15.0.7 \
        libnghttp2==1.58.0 \
        libnl==3.9.0 \
        libnpp==11.8.0.86 \
        libnsl==2.0.1 \
        libnuma==2.0.16 \
        libnvjpeg==11.9.0.86 \
        libogg==1.3.4 \
        libopenblas==0.3.26 \
        libopus==1.3.1 \
        libpng==1.6.42 \
        libpq==15.5 \
        libprotobuf==4.24.4 \
        libre2-11==2023.06.02 \
        librsvg==2.56.3 \
        libsndfile==1.2.2 \
        libsodium==1.0.18 \
        libspatialindex==1.9.3 \
        libsqlite==3.44.2 \
        libssh2==1.11.0 \
        libstdcxx-ng==13.2.0 \
        libsystemd0==255 \
        libthrift==0.19.0 \
        libtiff==4.5.1 \
        libtool==2.4.7 \
        libtorch==2.1.0 \
        libutf8proc==2.8.0 \
        libuuid==2.38.1 \
        libuv==1.46.0 \
        libvorbis==1.3.7 \
        libwebp==1.3.1 \
        libwebp-base==1.3.1 \
        libxcb==1.15 \
        libxcrypt==4.4.36 \
        libxkbcommon==1.6.0 \
        libxml2==2.12.4 \
        libzlib==1.2.13 \
        lz4-c==1.9.4 \
        markdown-it-py==3.0.0 \
        markupsafe==2.1.5 \
        matplotlib-inline==0.1.6 \
        mccabe==0.7.0 \
        mdurl==0.1.2 \
        mistune==3.0.2 \
        more-itertools==10.2.0 \
        mpc==1.3.1 \
        mpfr==4.2.1 \
        mpg123==1.32.4 \
        mpmath==1.3.0 \
        mypy_extensions==1.0.0 \
        mysql-common==8.0.33 \
        mysql-libs==8.0.33 \
        nbclient==0.8.0 \
        nbconvert==7.14.2 \
        nbconvert-core==7.14.2 \
        nbconvert-pandoc==7.14.2 \
        nbformat==5.9.2 \
        ncurses==6.4 \
        nest-asyncio==1.6.0 \
        nettle==3.6 \
        networkx==3.2.1 \
        nomkl==1.0 \
        nspr==4.35 \
        nss==3.97 \
        numpy==1.26.3 \
        numpydoc==1.6.0 \
        openh264==2.1.1 \
        openjpeg==2.5.0 \
        openssl==3.2.1 \
        orc==1.9.2 \
        packaging==23.2 \
        pandas==2.1.1 \
        pandoc==3.1.3 \
        pandocfilters==1.5.0 \
        pango==1.50.14 \
        parso==0.8.3 \
        pathspec==0.12.1 \
        pathtools==0.1.2 \
        pcre2==10.42 \
        pexpect==4.9.0 \
        pickleshare==0.7.5 \
        pillow==10.0.0 \
        pip==24.0 \
        pixman==0.43.2 \
        pkgutil-resolve-name==1.3.10 \
        platformdirs==4.2.0 \
        pluggy==1.4.0 \
        ply==3.11 \
        poppler==23.08.0 \
        poppler-data==0.4.12 \
        prompt-toolkit==3.0.42 \
        psutil==5.9.8 \
        pthread-stubs==0.4 \
        ptyprocess==0.7.0 \
        pulseaudio-client==16.1 \
        pure_eval==0.2.2 \
        pyarrow==11.0.0 \
        pycodestyle==2.10.0 \
        pycparser==2.21 \
        pydocstyle==6.3.0 \
        pyflakes==3.0.1 \
        pygments==2.17.2 \
        pylint==2.17.7 \
        pylint-venv==3.0.3 \
        pyls-spyder==0.4.0 \
        pyqt==5.15.9 \
        pyqt5-sip==12.12.2 \
        pyqtwebengine==5.15.9 \
        pysocks==1.7.1 \
        python==3.9.18 \
        python-dateutil==2.8.2 \
        python-fastjsonschema==2.19.1 \
        python-lsp-black==2.0.0 \
        python-lsp-jsonrpc==1.1.2 \
        python-lsp-server==1.7.4 \
        python-lsp-server-base==1.7.4 \
        python-slugify==8.0.3 \
        python-tzdata==2023.4 \
        python_abi==3.9 \
        pytoolconfig==1.2.5 \
        pytorch==2.1.0 \
        pytorch-cuda==11.8 \
        pytorch-mutex==1.0 \
        pytz==2024.1 \
        pyxdg==0.28 \
        pyyaml==6.0.1 \
        pyzmq==25.1.2 \
        qdarkstyle==3.1 \
        qstylizer==0.2.2 \
        qt-main==5.15.8 \
        qt-webengine==5.15.8 \
        qtawesome==1.3.0 \
        qtconsole==5.4.4 \
        qtconsole-base==5.4.4 \
        qtpy==2.4.1 \
        rdma-core==50.0 \
        re2==2023.06.02 \
        readline==8.2 \
        referencing==0.33.0 \
        requests==2.31.0 \
        rich==13.7.0 \
        rope==1.12.0 \
        rpds-py==0.17.1 \
        rtree==1.2.0 \
        s2n==1.4.1 \
        secretstorage==3.3.3 \
        sentry-sdk==1.40.0 \
        setproctitle==1.3.3 \
        setuptools==68.2.2 \
        sip==6.7.12 \
        six==1.16.0 \
        sleef==3.5.1 \
        smmap==5.0.0 \
        snappy==1.1.10 \
        snowballstemmer==2.2.0 \
        sortedcontainers==2.4.0 \
        soupsieve==2.5 \
        sphinx==7.2.6 \
        sphinxcontrib-applehelp==1.0.8 \
        sphinxcontrib-devhelp==1.0.6 \
        sphinxcontrib-htmlhelp==2.0.5 \
        sphinxcontrib-jsmath==1.0.1 \
        sphinxcontrib-qthelp==1.0.7 \
        sphinxcontrib-serializinghtml==1.1.10 \
        spyder==5.4.3 \
        spyder-kernels==2.4.4 \
        stack_data==0.6.2 \
        sympy==1.12 \
        tabulate==0.9.0 \
        text-unidecode==1.3 \
        textdistance==4.5.0 \
        three-merge==0.1.1 \
        tinycss2==1.2.1 \
        tk==8.6.13 \
        toml==0.10.2 \
        tomli==2.0.1 \
        tomlkit==0.12.3 \
        torchaudio==2.1.0 \
        torchvision==0.16.0 \
        tornado==6.3.3 \
        tqdm==4.66.1 \
        traitlets==5.14.1 \
        types-python-dateutil==2.8.19.20240106 \
        typing-extensions==4.9.0 \
        typing_extensions==4.9.0 \
        tzdata==2024a \
        ucx==1.15.0 \
        ujson==5.9.0 \
        urllib3==2.2.0 \
        wandb==0.15.12 \
        watchdog==3.0.0 \
        wcwidth==0.2.13 \
        webencodings==0.5.1 \
        whatthepatch==1.0.5 \
        wheel==0.42.0 \
        wrapt==1.16.0 \
        wurlitzer==3.0.3 \
        xcb-util==0.4.0 \
        xcb-util-image==0.4.0 \
        xcb-util-keysyms==0.4.0 \
        xcb-util-renderutil==0.3.9 \
        xcb-util-wm==0.4.1 \
        xkeyboard-config==2.40 \
        xorg-compositeproto==0.4.2 \
        xorg-damageproto==1.2.1 \
        xorg-fixesproto==5.0 \
        xorg-inputproto==2.3.2 \
        xorg-kbproto==1.0.7 \
        xorg-libice==1.1.1 \
        xorg-libsm==1.2.4 \
        xorg-libx11==1.8.7 \
        xorg-libxau==1.0.11 \
        xorg-libxcomposite==0.4.6 \
        xorg-libxdamage==1.1.5 \
        xorg-libxdmcp==1.1.3 \
        xorg-libxext==1.3.4 \
        xorg-libxfixes==5.0.3 \
        xorg-libxi==1.7.10 \
        xorg-libxrandr==1.5.2 \
        xorg-libxrender==0.9.11 \
        xorg-libxtst==1.2.3 \
        xorg-randrproto==1.5.0 \
        xorg-recordproto==1.14.2 \
        xorg-renderproto==0.11.1 \
        xorg-util-macros==1.19.3 \
        xorg-xextproto==7.3.0 \
        xorg-xf86vidmodeproto==2.3.1 \
        xorg-xproto==7.0.31 \
        xz==5.2.6 \
        yaml==0.2.5 \
        yapf==0.40.1 \
        zeromq==4.3.5 \
        zipp==3.17.0 \
        zlib==1.2.13 \
        zstd==1.5.5 \
    && conda clean -ya

RUN pip install -U --no-cache-dir \
    absl-py==2.1.0 \
    aiohttp==3.9.3 \
    aiosignal==1.3.1 \
    astunparse==1.6.3 \
    async-timeout==4.0.3 \
    cachetools==5.3.2 \
    contourpy==1.2.0 \
    cycler==0.12.1 \
    datasets==2.14.5 \
    dill==0.3.7 \
    fastobo==0.12.3 \
    flatbuffers==23.5.26 \
    fonttools==4.47.2 \
    frozenlist==1.4.1 \
    fsspec==2023.6.0 \
    gast==0.4.0 \
    google-auth==2.27.0 \
    google-auth-oauthlib==0.4.6 \
    google-pasta==0.2.0 \
    grpcio==1.60.1 \
    h5py==3.10.0 \
    joblib==1.3.2 \
    keras==2.11.0 \
    kiwisolver==1.4.5 \
    lark==1.1.9 \
    libclang==16.0.6 \
    llvmlite==0.42.0 \
    lxml==5.1.0 \
    markdown==3.5.2 \
    matplotlib==3.8.2 \
    multidict==6.0.5 \
    multiprocess==0.70.15 \
    numba==0.59.0 \
    oauthlib==3.2.2 \
    opt-einsum==3.3.0 \
    protobuf==3.19.6 \
    pyasn1==0.5.1 \
    pyasn1-modules==0.3.0 \
    pyparsing==3.1.1 \
    pyteomics==4.6.2 \
    requests-oauthlib==1.3.1 \
    rsa==4.9 \
    scikit-learn==1.3.1 \
    scipy==1.12.0 \
    spectrum-utils==0.4.2 \
    tensorboard==2.11.2 \
    tensorboard-data-server==0.6.1 \
    tensorboard-plugin-wit==1.8.1 \
    tensorflow==2.11.0 \
    tensorflow-estimator==2.11.0 \
    tensorflow-io-gcs-filesystem==0.35.0 \
    termcolor==2.4.0 \
    threadpoolctl==3.2.0 \
    werkzeug==3.0.1 \
    xxhash==3.4.1 \
    yarl==1.9.4
